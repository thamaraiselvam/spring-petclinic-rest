- hosts: backend_service
  remote_user: root
  gather_facts: false
  vars_files:
    - values.yaml
  tasks:
    - block:
      - name: Make sure destination dir exists
        file:
          path: "{{dest_root}}/spring-petclinic-rest/target/"
          state: directory
          recurse: yes
      - name: Copy jar file to bin directory
        copy:
          src: "/tmp/spring-petclinic-rest/target/spring-petclinic-rest-{{service_version}}.jar"
          dest: "{{dest_root}}/spring-petclinic-rest/target/spring-petclinic-rest-{{service_version}}.jar"
      - name: Create service file
        template:
          src: /tmp/spring-petclinic-rest/ansible/templates/backend_service.j2
          dest: /etc/systemd/system/petclinic-rest.service
          mode: 0644

      - name: Start service
        systemd:
          name: petclinic-rest
          state: restarted
          enabled: yes

      become: yes
      become_user: root
